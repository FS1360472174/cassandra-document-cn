#数据如何更新？#
Cassandra将每个新行都当做一个upsert:如果一个新行和一个已有的行有相同的primary key，Cassandra就会对这已有的行进行更新操作。

写数据时，Cassandra将每个新行都添加到数据库中，而不去检查是否有重复的记录存在。这个方法将有可能导致相同行在数据库中有多个版本存在。想要了解更多的信息，请查看[数据如何写入](http://docs.datastax.com/en/cassandra/3.0/cassandra/dml/dmlHowDataWritten.html)。

间断性的，存储在内存中的行会被冲刷到磁盘中的叫做SSTables结构文件中。在一个确定的间隔中，Cassandra将小的SSTables compacts成大的SSTables。如果在这个过程中，Cassandra遇到2个或更多版本的同一行数据。Cassandra只会将最新版本的数据写到新的SSTable。compaction结束后，Cassandra会删除掉原来的SSTables，以及过时的行。

大部分的Cassandra环境会将每一行的副本存在两个或多个节点上。每个节点都独立的执行compaction。这意味着即使一个过时版本的行数据在某个节点上被删除了，可能仍然存在于其他节点上。

这就是为什么Cassandra会在读操作过程中会执行另外一轮比较。当一个客户端根据一个特定的主键请求数据时，Cassandra会从一个或多个副本中产生多个版本的行数据。带有最新的时间戳的数据是唯一会被返回到客户端的数据("最后写赢策略")。

**注：**数据库操作可能只会更新一行数据的部分字段，因此有些版本的行只包括一些列，而不是全部。在写操作和compaction阶段，Cassandra从各个部分更新收集一个完整的行数据。每一列都使用最新的版本。